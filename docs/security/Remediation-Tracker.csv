ID,Priority,Title,Required Change (summary),Acceptance Criteria (summary),Files/Areas,Status,Owner,PR Link,Evidence Path,Notes/Blockers
0.1,P0,Replace browser tokens with secure cookie sessions,"Move OAuth to backend, issue HttpOnly+Secure+SameSite cookie; remove localStorage tokens; withCredentials on frontend","No localStorage tokens; cookie set with HttpOnly+Secure; API requires cookie; server-side logout clears cookie","frontend/src/apiClient.ts; frontend/src/pages/Login.tsx; frontend/src/services/googleCalendarService.ts; frontend/src/providers/GoogleAuthProvider.tsx; backend/app/api/api.py; backend/app/api/google_auth.py",Needs approval,,,evidence/A1-browser-tokens.md,"Architecture change; requires approval before implementing"
0.2,P0,Encrypt provider refresh tokens at rest,"App-layer encryption (DEK/KMS) for provider tokens; add enc+iv columns; backfill; drop plaintext","Encrypted columns present; rotation documented; no raw tokens in logs","backend/app/models/user.py; backend/app/db/migrations/add_google_auth_fields.py; admin backfill+drop endpoints",In Progress,,,evidence/A2-token-encryption.md,
0.3,P0,Remove or sanitize raw HTML rendering,"Replace dangerouslySetInnerHTML with sanitizer (DOMPurify) or markdown","No direct dangerouslySetInnerHTML for user content; tests strip <script>/onerror","frontend/src/components/modules/EditableSection.tsx; frontend/src/pages/PublicBlog.tsx",Not started,,,evidence/A3-xss-sanitization.md,
0.4,P0,Lock down uploads by size and type,Enforce MIME allowlist and 20MB cap; stream uploads; return 413/415,"413 on >20MB; 415 on disallowed type; no full file load in memory","backend/app/api/chat.py; backend/app/api/legal.py; backend/app/services/document_processor.py",Not started,,,evidence/A4-upload-guards.md,
0.5,P0,CORS and secret key hardening,"Restrict prod origins; avoid allow_methods[*]; require non-default SECRET_KEY via env","Process exits in prod if SECRET_KEY/DATABASE_URL missing; allow_origins only official UI","backend/app/core/config.py; backend/app/main.py",Not started,,,evidence/A5-cors-secret.md,
0.6,P0,Replace admin header token with RBAC,"Remove X-Admin-Token; require authenticated session and admin role; add rate limiting/audit; IP allowlist/VPN","401 without valid session+admin; no ADMIN_TASKS_TOKEN refs","backend/app/api/admin_tasks.py; auth middleware",Needs approval,,,evidence/A6-admin-rbac.md,"Requires role-based auth flow design"
A7,P0,Disable configuration probe endpoint in prod,Remove or restrict /api/test/config to internal/admin-only,"Endpoint not available in prod; 403/404 externally","backend/app/api/test_config.py",Not started,,,evidence/A7-config-probe.md,
A8,P1,Remove hardcoded Google Client ID fallback,Require VITE_GOOGLE_CLIENT_ID; fail build if missing; no literals in repo,"No literal client IDs; build fails without env","frontend/src/providers/GoogleAuthProvider.tsx; frontend/src/pages/TestGoogleAuth.tsx",Not started,,,evidence/A8-google-client-id.md,
1.1,P1,Brute force protection and admin 2FA,"Rate limit /token per user/IP; enable WebAuthn/TOTP for admin","10 wrong attempts/15m block; admin can enroll 2FA","backend/app/api/api.py; auth stack; frontend admin UI",Not started,,,evidence/P1-1.1-bruteforce-2fa.md,
1.2,P1,RAG and AI safety guardrails,"Pin system prompt; tool allowlist; source citations; tests against prompt injection","Exfiltration test fails; answers cite sources","backend/app/services/rag_chat.py; tests",Not started,,,evidence/P1-1.2-rag-guardrails.md,
1.3,P1,Schema migrations via Alembic,"Introduce Alembic; remove startup DDL; versioned scripts","alembic/versions populated; app starts without DDL","backend/app/db/migrations (new alembic); backend/app/db/db_init.py",Not started,,,evidence/P1-1.3-alembic.md,
1.4,P1,Security headers and CSP at edge,"Serve via proxy with CSP,HSTS,XCTO,Referrer-Policy; start report-only; enforce","Report-only zero violations; strict CSP enabled","Render/NGINX/edge config; frontend/public/index.html if meta used",Needs access,,,evidence/P1-1.4-csp.md,"Edge/proxy config access needed"
1.5,P1,Observability health and error reporting,"/healthz /readyz; structured JSON logs with request IDs; Sentry","Probes <50ms; errors captured with IDs; redactions applied","backend/app/main.py; logging config; Sentry setup",Not started,,,evidence/P1-1.5-observability.md,
2.1,P2,PII masking and selective encryption,"Identify sensitive fields; mask in logs/admin; encrypt targeted columns","Sensitive fields masked; policy/lint checks present","backend logging; admin UIs; schemas",Not started,,,evidence/P2-2.1-pii-masking.md,
2.2,P2,Dependency and image scanning in CI,"Add SAST/dependency/container scans; publish SBOM; fail on high CVEs","CI fails on high CVEs; SBOM attached",".github/workflows; backend/requirements.txt; frontend/package.json; Dockerfiles",Not started,,,evidence/P2-2.2-ci-scanning.md,
2.3,P2,Docker hardening,"Multi-stage builds; run as non-root; minimal images","Non-root USER; smaller image; Trivy shows no high CVEs","backend/Dockerfile; frontend/Dockerfile",Not started,,,evidence/P2-2.3-docker-hardening.md,

